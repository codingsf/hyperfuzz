/* Small test case that uses a vulnerable code snippet from */
/* blexim's article on "Basic Integer Overflows." */ 

#include <stdio.h>
#include <stdlib.h>

    char * myfunction(char *array, int len){
        char *myarray, i;

	printf("len : %d \n", len); 
        myarray = (char *) malloc(len * sizeof(int));    /* [1] */

	printf("myarray : %u \n", myarray); 

/*        if(myarray == NULL){
	    printf("myarray is NULL! \n"); 
            return NULL;
        }
*/

        for(i = 0; i < len; i++){              /* [2] */
            myarray[i] = array[i];
	    printf("i : %d ; len : %d \n", i, len); 
        }

        return myarray;
    }

int main(int argc, char **argv) 
{
  char * input;
  input = (char *) malloc(sizeof(char)*20); 
  FILE *fd = fopen(argv[1], "r"); 
  fgets(input, sizeof input, fd); 
  char * buf;
  int len; 

//  len = atoi(input); 
  len = input[0]; 

  buf = myfunction(input, len); 
  free(buf); 
  free(input); 
  return 0;
}

/* Small test case based on code snippet from blexim, */
/* "Basic Integer Overflows" */ 

#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/stat.h>

int copy_something(char *buf, int len){
  char * kbuf;
  int ret; 
  kbuf = (char *)malloc(sizeof(char)*800);

  if(len > 800)        /* [1] */
  { 
    return -1;
  }

  ret = (int) memcpy(kbuf, buf, len);  /* [2] */
  free(kbuf); 
  return ret; 
}

int main(int argc, char **argv) 
{
  char * input;
  int ret;
  int len; 
  int fd = open(argv[1], O_RDONLY); 
  input = malloc(sizeof(char)*80); 
  read(fd, input, sizeof(char)*80); 

  len = input[0]; 
  ret = copy_something(input, len); 
  free(input);
  return 0; 
}
